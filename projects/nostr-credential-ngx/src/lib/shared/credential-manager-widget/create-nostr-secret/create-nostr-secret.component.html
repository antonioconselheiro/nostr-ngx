<h2 class="title">Create account</h2>

<form [formGroup]="generateNostrSecretForm" (submit)="onSubmit()" novalidate autocomplete="off">
  <ul>
    <li>
      Nostr secret (nsec) can't be changed.
    </li>
    <li>
      It gives complete access to account.
    </li>
    <li>
      If you lost it, your account will be lost forever.
    </li>
  </ul>

  <div [class.error]="submitted && getFormControlErrors('nostrSecret')" class="floatingLabel">
    <input #nostrSecret name="nostrSecret" maxlength="64" formControlName="nostrSecret" id="generateNostrSecretField"
      readonly [attr.type]="showNostrSecret ? 'text' : 'password'" placeholder=" " />
    <label for="generateNostrSecretField">Nostr Secret (nsec)</label>

    <button (click)="generateNostrSecret()" type="button" tabindex="10" title="generate new nsec"
      class="bordered svgButton">
      <nostr-svg-render name="repeat"></nostr-svg-render>
    </button>

    <button type="button" tabindex="18" [attr.title]="showNostrSecret ? 'hide nostr secret' : 'show nostr secret'"
      (click)="showNostrSecret = !showNostrSecret" class="bordered svgButton">
      <nostr-svg-render [name]="showNostrSecret ? 'eyeOff' : 'eye'"></nostr-svg-render>
    </button>
  </div>

  <div class="floatingLabel">
    <input #password name="password" tabindex="11" [maxlength]="passwordLength" formControlName="password"
      (keyup)="updateNcryptsec(password.value)" (change)="renderQRCode()" id="createNostrSecretPasswordField"
      [attr.type]="showPassword ? 'text' : 'password'" placeholder=" " />

    <label for="createNostrSecretPasswordField">Password</label>

    <button type="button" tabindex="4" [attr.title]="showPassword ? 'hide password' : 'show password'"
      (click)="showPassword = !showPassword" class="bordered svgButton">
      <nostr-svg-render [name]="showPassword ? 'eyeOff' : 'eye'"></nostr-svg-render>
    </button>

    <ng-container *ngIf="showErrors('password')">
      <span *ngIf="getFormControlErrorStatus('password', 'invalid')" class="error">
        Invalid password, nsec could not be open
      </span>
    </ng-container>
  </div>

  <ng-container *ngIf="password.value">
    <div class="floatingLabel">
      <input #confirmPassword name="confirmPassword" tabindex="12" [maxlength]="passwordLength"
        formControlName="confirmPassword" id="createNostrSecretRepeatPasswordField"
        [attr.type]="showPassword ? 'text' : 'password'" placeholder=" " />

      <label for="createNostrSecretRepeatPasswordField">Confirm password</label>

      <button type="button" tabindex="4" [attr.title]="showConfirmPassword ? 'hide password' : 'show password'"
        (click)="showConfirmPassword = !showConfirmPassword" class="bordered svgButton">
        <nostr-svg-render [name]="showConfirmPassword ? 'eyeOff' : 'eye'"></nostr-svg-render>
      </button>

      <ng-container *ngIf="showErrors('password')">
        <span *ngIf="getFormControlErrorStatus('password', 'invalid')" class="error">
          Invalid password, nsec could not be open
        </span>
      </ng-container>
    </div>

    <div class="floatingLabel">
      <input #qrcodeName name="qrcodeName" tabindex="12" formControlName="qrcodeName"
        id="createNostrSecretQrcodeNameField" (keyup)="renderQRCode()" type="text" placeholder=" " />

      <label for="createNostrSecretQrcodeNameField">QRCode Title</label>
    </div>

    Save this qrcode, it contains your Nostr secret encrypted with your password.

    <div>
      <img *ngIf="qrcode" class="qrcode" [src]="qrcode" #qrcode />
    </div>
  </ng-container>

  <div class="buttonGroup">
    <button (click)="changeStep.next('selectAccount')" type="button" tabindex="3" title="back"
      class="actionButton button secondary iconedButton">
      <nostr-svg-render class="inlineIcon" name="left"></nostr-svg-render>

      <span>
        Back
      </span>
    </button>

    <button (click)="downloadQrcode()" type="button" tabindex="3" title="download"
      class="actionButton button iconedButton">
      <nostr-svg-render class="inlineIcon" name="download"></nostr-svg-render>

      <span>
        Download
      </span>
    </button>

    <button (click)="changeStep.next('relayManager')" type="submit" tabindex="3" title="next"
      class="actionButton button iconedButton" disabled>
      <nostr-svg-render class="inlineIcon" name="right"></nostr-svg-render>

      <span>
        Next
      </span>
    </button>
  </div>
</form>