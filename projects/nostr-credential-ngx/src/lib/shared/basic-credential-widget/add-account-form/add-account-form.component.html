<h2>Add account</h2>
<form [formGroup]="accountForm" (submit)="onAddAccountSubmit($event)" novalidate autocomplete="off">
  <div [class.error]="submitted && getFormControlErrors('nsec')" class="floating-label">
    <input #nsec required name="nsec" tabindex="1" maxlength="64" formControlName="nsec" id="addAccountNsecField"
      [class.has-value]="nsec.value" [attr.readonly]="loading ? 'readonly' : null"
      [attr.type]="showNostrSecret ? 'text' : 'password'" />
    <label for="addAccountNsecField">Nostr Secret (nsec)</label>

    <button type="button" tabindex="4" title="read nsec from qrcode" (click)="readQrcodeUsingCamera(password)"
      class="bordered svg-button">

      <div class="svg-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-qr-code-scan" viewBox="0 0 16 16">
          <path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3Zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5ZM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5ZM4 4h1v1H4V4Z"/>
          <path d="M7 2H2v5h5V2ZM3 3h3v3H3V3Zm2 8H4v1h1v-1Z"/>
          <path d="M7 9H2v5h5V9Zm-4 1h3v3H3v-3Zm8-6h1v1h-1V4Z"/>
          <path d="M9 2h5v5H9V2Zm1 1v3h3V3h-3ZM8 8v2h1v1H8v1h2v-2h1v2h1v-1h2v-1h-3V8H8Zm2 2H9V9h1v1Zm4 2h-1v1h-2v1h3v-2Zm-4 2v-1H8v1h2Z"/>
          <path d="M12 9h2V8h-2v1Z"/>
        </svg>
      </div>
    </button>

    <button type="button" tabindex="4" [attr.title]="showNostrSecret ? 'hide nostr secret' : 'show nostr secret'"
      (click)="showNostrSecret = !showNostrSecret" class="bordered svg-button">

      <div class="svg-wrapper">
        <i-tabler [name]="showNostrSecret ? 'eye-off' : 'eye'"></i-tabler>
      </div>
    </button>

    <ng-container *ngIf="submitted">
      <span *ngIf="getFormControlErrorStatus('nsec', 'required')" class="error">Nostr Secret cannot be blank</span>
      <span *ngIf="getFormControlErrorStatus('nsec', 'invalidNostrPublicGivenInstead')" class="error">Nostr Public given
        instead Nostr Secret</span>
      <span *ngIf="getFormControlErrorStatus('nsec', 'invalidNostrSecret')" class="error">Invalid Nostr Secret</span>
      <span *ngIf="getFormControlErrorStatus('nsec', 'nostrSecretNotFound')" class="error">Could not found this account
        in current relay pool</span>
    </ng-container>
  </div>

  <div [class.error]="submitted && getFormControlErrors('password')" class="floating-label password-field">
    <input #password required name="password" tabindex="2" [maxlength]="passwordLength" formControlName="password" id="addAccountPasswordField"
      [class.has-value]="password.value" [attr.readonly]="loading ? 'readonly' : null"
      [attr.type]="showPassword ? 'text' : 'password'" />

    <label for="addAccountPasswordField">Pin</label>

    <!-- TODO: incluir popover ao clique com explicação do porquê do pin -->
    <button title="tap for information" type="button" tabindex="6" class="bordered svg-button">
      <div class="svg-wrapper">
        <i-tabler name="info-circle"></i-tabler>
      </div>
    </button>

    <button type="button" tabindex="7" [attr.title]="showPassword ? 'hide pin' : 'show pin'"
      (click)="showPassword = !showPassword" class="bordered svg-button">

      <div class="svg-wrapper">
        <i-tabler [name]="showPassword ? 'eye-off' : 'eye'"></i-tabler>
      </div>
    </button>

    <ng-container *ngIf="submitted">
      <span *ngIf="getFormControlErrorStatus('password', 'required')" class="error">Include a password to improve your
        privacity</span>
    </ng-container>
  </div>

  <div class="button-group">
    <button type="submit" tabindex="2" title="add account" class="button secondary iconed-button">
      <div *ngIf="!loading" class="inline-icon icon-add">
        <div role="img"></div>
      </div>

      <nostr-loading *ngIf="loading"></nostr-loading>

      <span>
        Add account
      </span>
    </button>

    <button *ngIf="accounts.length" type="button" tabindex="3" title="back" (click)="changeStep.next('select-account')"
      class="button secondary iconed-button">
      <div class="inline-icon icon-back">
        <div role="img"></div>
      </div>

      <span>
        Back
      </span>
    </button>
  </div>
</form>
